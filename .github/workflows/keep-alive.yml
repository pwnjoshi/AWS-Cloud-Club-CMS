name: Aggressive Render Keep Alive

on:
  schedule:
    # GitHub cron is best-effort, so we run VERY frequently
    - cron: "*/2 * * * *"   # every 2 minutes
  workflow_dispatch:

jobs:
  keep-alive:
    runs-on: ubuntu-latest
    timeout-minutes: 10

    steps:
      - name: Timestamp
        run: echo "‚è∞ Started at $(date -u)"

      - name: Warm up backend (multiple real GET hits)
        run: |
          URL="https://aws-cloud-club-backend.onrender.com/api/events/"

          for i in {1..6}
          do
            echo "üî• Ping attempt $i"
            curl -sS \
              --retry 3 \
              --retry-delay 5 \
              --connect-timeout 20 \
              --max-time 40 \
              -A "Mozilla/5.0 GitHub-Actions-KeepAlive" \
              "$URL" || true
            sleep 15
          done

      - name: Final check
        run: |
          curl -v \
            -A "Mozilla/5.0 GitHub-Actions-Final-Check" \
            https://aws-cloud-club-backend.onrender.com/api/events/

      - name: Finished
        run: echo "‚úÖ Finished at $(date -u)"
